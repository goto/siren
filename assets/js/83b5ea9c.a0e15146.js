"use strict";(self.webpackChunksiren=self.webpackChunksiren||[]).push([[153],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=l(n),m=a,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,o[1]=p;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6657:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return p},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return c},default:function(){return u}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],p={},s="Code Architecture",l={unversionedId:"concepts/code",id:"concepts/code",isDocsHomePage:!1,title:"Code Architecture",description:"Start with a bird\u2019s eye overview of the problem being solved.",source:"@site/docs/concepts/code.md",sourceDirName:"concepts",slug:"/concepts/code",permalink:"/siren/docs/concepts/code",editUrl:"https://github.com/odpf/siren/edit/master/docs/docs/concepts/code.md",tags:[],version:"current",lastUpdatedBy:"Ravi Suhag",lastUpdatedAt:1639651441,formattedLastUpdatedAt:"12/16/2021",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Architecture",permalink:"/siren/docs/concepts/architecture"},next:{title:"Schema Design",permalink:"/siren/docs/concepts/schema"}},c=[{value:"Bird&#39;s Eye View",id:"birds-eye-view",children:[]},{value:"Code map",id:"code-map",children:[]}],d={toc:c};function u(e){var t=e.components,p=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},d,p,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"code-architecture"},"Code Architecture"),(0,i.kt)("p",null,"Start with a bird\u2019s eye overview of the problem being solved."),(0,i.kt)("p",null,"Siren is web service which simplifies alerting for a wide range of application. It provides a simple interface to manage\nCortex Rules and Alertmanager configuration."),(0,i.kt)("p",null,"This document describes the high-level code architecture of Siren. If you want to familiarize yourself with the code\nbase, you are just in the right place!"),(0,i.kt)("h2",{id:"birds-eye-view"},"Bird's Eye View"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Siren Architecture",src:n(8792).Z})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Input:")," Siren takes user input either from HTTP APIs in request body or YAML files from CLI Commands."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Output:")," The output is DB state change and/or Cortex Rule Group updates or Cortex Alert Manager configuration."),(0,i.kt)("p",null,"Siren HTTP APIs call cortex endpoints to carry out the required tasks."),(0,i.kt)("h2",{id:"code-map"},"Code map"),(0,i.kt)("p",null,"This section talks briefly about various important directories and data structures."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Build:")," Siren uses ",(0,i.kt)("inlineCode",{parentName:"p"},"make")," to perform various build and alike operations. See ",(0,i.kt)("inlineCode",{parentName:"p"},"Makefile")," for list of options."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},".github/"))),(0,i.kt)("p",null,"Github workflow management for releasing a build."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"main.go"))),(0,i.kt)("p",null,"Entry point for the application where cobra CLI commander is initialized."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"cmd/"))),(0,i.kt)("p",null,"Contains list of commands which Siren CLI can server. Each file here typically asks ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," to load configs and passes\nthem to appropriate functions inside ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," package. For example: Loading configs and passing them to start web server."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"app/config.go"))),(0,i.kt)("p",null,"Loads config by reading the ",(0,i.kt)("inlineCode",{parentName:"p"},"config.yaml")," file and env variables. Precedence is given to ENV variables."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"app/server.go"))),(0,i.kt)("p",null,"Starts a Golang application server with cortex ruler, alertmanager and Siren Service host configurations."),(0,i.kt)("p",null,"It also takes care of running the Migrations by delegating it to ",(0,i.kt)("inlineCode",{parentName:"p"},"service")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"service/"))),(0,i.kt)("p",null,"Service container initialized services from packages defined inside ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg/")),(0,i.kt)("p",null,"It also runs migrations by delegating the calls to ",(0,i.kt)("inlineCode",{parentName:"p"},"services")," of packages defined inside ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg/")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"store/")),"\nInitializes new databases instance."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"api/")),"\nThis holds ",(0,i.kt)("inlineCode",{parentName:"p"},"gorilla/mux")," router and handlers for functionalities provided by packages defined inside ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg/")," over HTTP."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"pkg/")),"\nContains the libraries which perform CRUD over specific resources. For example templates, rules etc."),(0,i.kt)("p",null,"Let's take an example of what each file denotes."),(0,i.kt)("p",null,"template package holds model, repository and service to perform CRUD over template resource.\n",(0,i.kt)("inlineCode",{parentName:"p"},"model.go")," holds the data definition, ",(0,i.kt)("inlineCode",{parentName:"p"},"repository.go")," uses data models defined inside model to perform database\noperations. ",(0,i.kt)("inlineCode",{parentName:"p"},"service.go")," is the interface between ",(0,i.kt)("inlineCode",{parentName:"p"},"app")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg/templates"),". It performs data type conversion."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"service")," allows ",(0,i.kt)("inlineCode",{parentName:"p"},"api")," to choose any data representation (defined inside ",(0,i.kt)("inlineCode",{parentName:"p"},"domain/"),") and still be use the CRUD\nfunctionality provided by ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg/templates")," package."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"domain")),"\nDefines the user facing data representation of the various resources. It also defines the interface for operations on\nthese resources in ",(0,i.kt)("inlineCode",{parentName:"p"},"service"),". Structures inside ",(0,i.kt)("inlineCode",{parentName:"p"},"pkg")," implement this interface."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"client"))),(0,i.kt)("p",null,"It is the autogenerated HTTP Client for Siren APIs generated from the swagger schema of Siren APIs\nusing ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/swagger-api/swagger-codegen"},"swagger-codegen"),", and it is used inside CLI command ",(0,i.kt)("inlineCode",{parentName:"p"},"upload")," to\ncall the Siren APIs. It serves as Siren SDK for Golang applications. This should be regenerated when API contact\nupdates."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"docs"))),(0,i.kt)("p",null,"Swagger schema specification and project documentation is held here. The golang files inside here are parsed to generate\nswagger schema using DSL defined by ",(0,i.kt)("a",{parentName:"p",href:"https://goswagger.io/use/spec/meta.html"},"go-swagger")))}u.isMDXComponent=!0},8792:function(e,t,n){t.Z=n.p+"assets/images/siren-ff8dcd5db93b256e2e45743f85659af0.jpg"}}]);