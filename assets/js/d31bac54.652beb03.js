"use strict";(self.webpackChunksiren=self.webpackChunksiren||[]).push([[677],{3905:(e,n,r)=>{r.d(n,{Zo:()=>c,kt:()=>g});var t=r(7294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=t.createContext({}),u=function(e){var n=t.useContext(s),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},c=function(e){var n=u(e.components);return t.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(r),g=i,m=p["".concat(s,".").concat(g)]||p[g]||d[g]||a;return r?t.createElement(m,o(o({ref:n},c),{},{components:r})):t.createElement(m,o({ref:n},c))}));function g(e,n){var r=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var u=2;u<a;u++)o[u]=r[u];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}p.displayName="MDXCreateElement"},8613:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var t=r(3117),i=(r(7294),r(3905));const a={},o="Start Server",l={unversionedId:"tour/start_server",id:"tour/start_server",title:"Start Server",description:"1. Build Siren",source:"@site/docs/tour/1_start_server.md",sourceDirName:"tour",slug:"/tour/start_server",permalink:"/siren/docs/tour/start_server",draft:!1,editUrl:"https://github.com/odpf/siren/edit/master/docs/docs/tour/1_start_server.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"docsSidebar",previous:{title:"Introduction",permalink:"/siren/docs/tour/overview"},next:{title:"Register provider",permalink:"/siren/docs/tour/registering_provider"}},s={},u=[{value:"1. Build Siren",id:"1-build-siren",level:2},{value:"2. Generate Siren config",id:"2-generate-siren-config",level:2},{value:"Update Config of Cortex Webhook URL",id:"update-config-of-cortex-webhook-url",level:3},{value:"3. Start-up Siren dependencies",id:"3-start-up-siren-dependencies",level:2},{value:"4. Run Siren server",id:"4-run-siren-server",level:2},{value:"5. Migrate Siren DB",id:"5-migrate-siren-db",level:2},{value:"6. Siren client CLI Config Initialization",id:"6-siren-client-cli-config-initialization",level:2}],c={toc:u};function d(e){let{components:n,...r}=e;return(0,i.kt)("wrapper",(0,t.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"start-server"},"Start Server"),(0,i.kt)("h2",{id:"1-build-siren"},"1. Build Siren"),(0,i.kt)("p",null,"We'll start our tour by building siren and generating the default configuration. Run this command to build ",(0,i.kt)("inlineCode",{parentName:"p"},"siren"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ make build\n")),(0,i.kt)("p",null,"Once succeed, you will get this message and there is a ",(0,i.kt)("inlineCode",{parentName:"p"},"siren")," binary in the folder."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},' > building siren version v0.4.1-next\ngo build -ldflags "-X main.Version="v0.4.1-next"" "github.com/odpf/siren"\n - build complete\n')),(0,i.kt)("h2",{id:"2-generate-siren-config"},"2. Generate Siren config"),(0,i.kt)("p",null,"Before starting Siren server, you need to have a proper config file. Run server config initialization command to generate a config file with the defaults value."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ ./siren server init\n")),(0,i.kt)("p",null,"You will have a new config file ",(0,i.kt)("inlineCode",{parentName:"p"},"./config.yaml")," with the default values. The default values would be the minimum config to get Siren up and running."),(0,i.kt)("h3",{id:"update-config-of-cortex-webhook-url"},"Update Config of Cortex Webhook URL"),(0,i.kt)("p",null,"When we register a cortex provider, we need to set the alertmanager config ",(0,i.kt)("inlineCode",{parentName:"p"},"webhook_config")," and set Siren API to send alerts to Siren from Cortex. You need to update ",(0,i.kt)("inlineCode",{parentName:"p"},"webhook_url")," of ",(0,i.kt)("inlineCode",{parentName:"p"},"cortex")," in Siren to be like this."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"providers:\n    cortex:\n        webhook_url: http://host.docker.internal:8080\n")),(0,i.kt)("h2",{id:"3-start-up-siren-dependencies"},"3. Start-up Siren dependencies"),(0,i.kt)("p",null,"We are using ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose")," to start-up all dependencies of Siren. See ",(0,i.kt)("a",{parentName:"p",href:"/siren/docs/introduction"},"introduction")," to see what components are defined in ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose"),"."),(0,i.kt)("p",null,"To start all dependencies of Siren, run."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose up -d\n")),(0,i.kt)("p",null,"If you haven't got dependencies (postgresql, cortex, etc) images in your local, this might take a while to fetch all images. If all dependencies are successfully started, you will get this message in the terminal."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"[+] Running 8/8\n \u283f Network siren_siren              Created 0.0s\n \u283f Network siren_default            Created 0.0s\n \u283f Container siren-minio1-1         Started 0.6s\n \u283f Container siren_postgres         Started 0.6s\n \u283f Container siren-createbuckets-1  Started 0.8s\n \u283f Container siren_cortex_am        Started 0.9s\n \u283f Container siren_cortex_all       Started 1.1s\n \u283f Container siren_nginx            Started 1.3s\n")),(0,i.kt)("h2",{id:"4-run-siren-server"},"4. Run Siren server"),(0,i.kt)("p",null,"If all dependencies are up and running, you can start running Siren server. To run a Siren server, we could just need to run a command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ ./siren server start\n")),(0,i.kt)("p",null,"Siren will auto-recognize ",(0,i.kt)("inlineCode",{parentName:"p"},"./config.yaml")," file as its config file and fetch all configs inside it to be used in Siren server. The default config also runs two notification workers inside Siren server. If it is running properly, you will see this logs inside terminal."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'{"severity":"INFO","timestamp":"2022-10-20T11:19:46.486792+07:00","caller":"log/zap.go:24","message":"running worker","serviceContext":{"service":"siren"},"id":"a2ef71b6-b8a6-4d3c-8358-bfe406f268d6"}\n{"severity":"INFO","timestamp":"2022-10-20T11:19:46.486766+07:00","caller":"log/zap.go:24","message":"running worker","serviceContext":{"service":"siren"},"id":"361945b4-aaf3-4e45-afb9-605888c1ebda"}\n{"severity":"INFO","timestamp":"2022-10-20T11:19:46.487412+07:00","caller":"log/zap.go:24","message":"server is running","serviceContext":{"service":"siren"},"host":"localhost","port":8080}\n')),(0,i.kt)("h2",{id:"5-migrate-siren-db"},"5. Migrate Siren DB"),(0,i.kt)("p",null,"To migrate Siren's DB (Postgres), you just need to run this command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ ./siren server migrate\n")),(0,i.kt)("p",null,"This will create all necessary tables inside Siren's DB."),(0,i.kt)("h2",{id:"6-siren-client-cli-config-initialization"},"6. Siren client CLI Config Initialization"),(0,i.kt)("p",null,"Siren client CLI require some configurations to communicate to Siren server. One of them is Siren host. To create Siren client config, run."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"./siren config init\n")),(0,i.kt)("p",null,"This will autogenerate Siren client config inside path ",(0,i.kt)("inlineCode",{parentName:"p"},"${HOME}/odpf/siren.yaml")," with the default value. Ideally, you don't need to do anything with the value, the default value should be compatible in this tour."),(0,i.kt)("p",null,"Once Siren server is up and running, we can start configuring Siren to our needs."))}d.isMDXComponent=!0}}]);