(self.webpackChunksiren=self.webpackChunksiren||[]).push([[1690],{1410:function(e,t,r){var o=r(7694),a=r(3618);e.exports={title:"Siren",tagline:"Universal data observability toolkit",url:"https://odpf.github.io",baseUrl:"/siren/",onBrokenLinks:"throw",onBrokenMarkdownLinks:"warn",favicon:"img/favicon.ico",organizationName:"odpf",projectName:"siren",customFields:{apiVersion:"v1beta1",defaultHost:"http://localhost:8080"},themeConfig:{colorMode:{defaultMode:"light",respectPrefersColorScheme:!0,switchConfig:{darkIcon:"\u263e",lightIcon:"\u2600\ufe0f"}},navbar:{title:"Siren",logo:{src:"img/logo.svg"},items:[{type:"doc",docId:"introduction",position:"left",label:"Docs"},{to:"/blog",label:"Blog",position:"left"},{to:"/help",label:"Help",position:"left"},{href:"https://bit.ly/2RzPbtn",position:"right",className:"header-slack-link"},{href:"https://github.com/odpf/siren",className:"navbar-item-github",position:"right"}]},footer:{style:"light",links:[{title:"Products",items:[{label:"Meteor",href:"https://github.com/odpf/meteor"},{label:"Firehose",href:"https://github.com/odpf/firehose"},{label:"Raccoon",href:"https://github.com/odpf/raccoon"},{label:"Dagger",href:"https://odpf.github.io/dagger/"}]},{title:"Resources",items:[{label:"Docs",to:"/docs/introduction"},{label:"Blog",to:"/blog"},{label:"Help",to:"/help"}]},{title:"Community",items:[{label:"Slack",href:"https://bit.ly/2RzPbtn"},{label:"GitHub",href:"https://github.com/odpf/siren"}]}],copyright:"Copyright \xa9 2022-"+(new Date).getFullYear()+" ODPF"},prism:{theme:o,darkTheme:a},gtag:{trackingID:"G-XXX"},announcementBar:{id:"star-repo",content:'\u2b50\ufe0f If you like Siren, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/odpf/siren">GitHub</a>! \u2b50',backgroundColor:"#222",textColor:"#eee",isCloseable:!0}},presets:[["@docusaurus/preset-classic",{docs:{showLastUpdateAuthor:!0,showLastUpdateTime:!0,sidebarPath:6679,editUrl:"https://github.com/odpf/siren/edit/master/docs/"},blog:{showReadingTime:!0,editUrl:"https://github.com/odpf/siren/edit/master/docs/blog/"},theme:{customCss:[5308,2295]}}]]}},8215:function(e,t,r){"use strict";var o=r(7294);t.Z=function(e){var t=e.children,r=e.hidden,a=e.className;return o.createElement("div",{role:"tabpanel",hidden:r,className:a},t)}},5064:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var o=r(7294),a=r(9443);var n=function(){var e=(0,o.useContext)(a.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=r(6010),s="tabItem_vU9c",l="tabItemActive_cw6a";var c=function(e){var t,r=e.lazy,a=e.block,c=e.defaultValue,u=e.values,p=e.groupId,d=e.className,m=o.Children.toArray(e.children),g=null!=u?u:m.map((function(e){return{value:e.props.value,label:e.props.label}})),h=null!=c?c:null==(t=m.find((function(e){return e.props.default})))?void 0:t.props.value,f=n(),b=f.tabGroupChoices,y=f.setTabGroupChoices,v=(0,o.useState)(h),k=v[0],w=v[1],C=[];if(null!=p){var _=b[p];null!=_&&_!==k&&g.some((function(e){return e.value===_}))&&w(_)}var N=function(e){var t=e.currentTarget,r=C.indexOf(t),o=g[r].value;w(o),null!=p&&(y(p,o),setTimeout((function(){var e,r,o,a,n,i,s,c;(e=t.getBoundingClientRect(),r=e.top,o=e.left,a=e.bottom,n=e.right,i=window,s=i.innerHeight,c=i.innerWidth,r>=0&&n<=c&&a<=s&&o>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},A=function(e){var t,r=null;switch(e.key){case"ArrowRight":var o=C.indexOf(e.target)+1;r=C[o]||C[0];break;case"ArrowLeft":var a=C.indexOf(e.target)-1;r=C[a]||C[C.length-1]}null==(t=r)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},d)},g.map((function(e){var t=e.value,r=e.label;return o.createElement("li",{role:"tab",tabIndex:k===t?0:-1,"aria-selected":k===t,className:(0,i.Z)("tabs__item",s,{"tabs__item--active":k===t}),key:t,ref:function(e){return C.push(e)},onKeyDown:A,onFocus:N,onClick:N},null!=r?r:t)}))),r?(0,o.cloneElement)(m.filter((function(e){return e.props.value===k}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},m.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==k})}))))}},6679:function(e){e.exports={docsSidebar:["introduction",{type:"category",label:"Tour",items:["tour/introduction","tour/startup_siren_server","tour/registering_provider","tour/registering_receivers","tour/sending_notifications_to_receiver","tour/configuring_provider_alerting_rules","tour/subscribing_notifications"]},{type:"category",label:"Concepts",items:["concepts/overview","concepts/plugin","concepts/schema"]},{type:"category",label:"Guides",items:["guides/overview","guides/provider_and_namespace","guides/receiver","guides/subscription","guides/rule","guides/template","guides/alert_history","guides/notification","guides/deployment"]},{type:"category",label:"Contribute",items:["contribute/contribution","contribute/receiver","contribute/provider","contribute/release"]},{type:"category",label:"Reference",items:["reference/api","reference/server_configuration","reference/client_configuration","reference/receiver","reference/cli"]}]}},7508:function(e,t,r){"use strict";r.r(t),r.d(t,{frontMatter:function(){return d},contentTitle:function(){return m},metadata:function(){return g},toc:function(){return h},apiVersion:function(){return f},defaultHost:function(){return b},default:function(){return v}});var o=r(7462),a=r(3366),n=(r(7294),r(3905)),i=r(5064),s=r(8215),l=r(6213),c=r(1410),u=r.n(c),p=["components"],d={},m="Alert History",g={unversionedId:"guides/alert_history",id:"guides/alert_history",isDocsHomePage:!1,title:"Alert History",description:"export const apiVersion = siteConfig.customFields.apiVersion",source:"@site/docs/guides/alert_history.md",sourceDirName:"guides",slug:"/guides/alert_history",permalink:"/siren/docs/guides/alert_history",editUrl:"https://github.com/odpf/siren/edit/master/docs/docs/guides/alert_history.md",tags:[],version:"current",lastUpdatedBy:"Ravi Suhag",lastUpdatedAt:1666359878,formattedLastUpdatedAt:"10/21/2022",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Template",permalink:"/siren/docs/guides/template"},next:{title:"Notification",permalink:"/siren/docs/guides/notification"}},h=[{value:"Cortex Alertmanager",id:"cortex-alertmanager",children:[{value:"Alert History Creation via API",id:"alert-history-creation-via-api",children:[]}]}],f=u().customFields.apiVersion,b=u().customFields.defaultHost,y={toc:h,apiVersion:f};function v(e){var t=e.components,r=(0,a.Z)(e,p);return(0,n.kt)("wrapper",(0,o.Z)({},y,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"alert-history"},"Alert History"),(0,n.kt)("p",null,"Siren can store the alerts triggered by provider e.g. Cortex Alertmanager. Provider needs to be configured to call Siren API using a webhook."),(0,n.kt)("h2",{id:"cortex-alertmanager"},"Cortex Alertmanager"),(0,n.kt)("p",null,"For Cortex Alertmanager, everytime a provider is added, a default ",(0,n.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/alerting/latest/configuration/#webhook_config"},"webhook_config")," receiver with empty route condition is set, which will result in calling the defined Siren API's on all alerts. This sync also happens everytime the server started."),(0,n.kt)("p",null,"Example Cortex Alertmanager config"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"receivers:\n  - name: default\n    webhook_configs:\n      - send_resolved: true\n        http_config:\n          follow_redirects: true\n        url: http://localhost:8080/v1beta1/alerts/cortex/3 # siren API\n        max_alerts: 0\n")),(0,n.kt)("p",null,"Note that the url has ",(0,n.kt)("inlineCode",{parentName:"p"},"cortex/3")," at the end, which means this will be able to parse alert history payloads from cortex type and store in DB by making it belong to provider id ",(0,n.kt)("inlineCode",{parentName:"p"},"3"),". After this, as soon as any alert is triggered, it will be sent to Siren for history and a notification will also be published."),(0,n.kt)("p",null,"All information on triggered alerts depend on the alerting rule configured in Siren (synced to Cortex Ruler). Main information that should exist in the rule are:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Which alert was triggered"),(0,n.kt)("li",{parentName:"ul"},"Which resource this alert refers to"),(0,n.kt)("li",{parentName:"ul"},"On which metric, this alert was triggered"),(0,n.kt)("li",{parentName:"ul"},"What was the metric value for alert trigger"),(0,n.kt)("li",{parentName:"ul"},"What was the severity of alert (CRITICAL, WARNING or RESOLVED)")),(0,n.kt)("p",null,"For reusability, rule in siren need to be defined based on a ",(0,n.kt)("a",{parentName:"p",href:"/siren/docs/guides/template"},"template"),". Template's body describes what data that is rendered once the variable is applied."),(0,n.kt)("p",null,"An Example of rule's template:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v2\ntype: template\nname: CPU\nbody:\n  - alert: CPUWarning\n    expr: avg by (host) (cpu_usage_user{cpu="cpu-total"}) > [[.warning]]\n    for: "[[.for]]"\n    labels:\n      severity: WARNING\n    annotations:\n      description: CPU has been above [[.warning]] for last [[.for]] {{ $labels.host }}\n      resource: { { $labels.instance } }\n      template: CPU\n      metricName: cpu_usage_user\n      metricValue: { { $labels.cpu_usage_user } }\n  - alert: CPUCritical\n    expr: avg by (host) (cpu_usage_user{cpu="cpu-total"}) > [[.critical]]\n    for: "[[.for]]"\n    labels:\n      severity: CRITICAL\n    annotations:\n      description: CPU has been above [[.critical]] for last [[.for]] {{ $labels.host }}\n      resource: { { $labels.instance } }\n      template: CPU\n      metricName: cpu_usage_user\n      metricValue: { { $labels.cpu_usage_user } }\nvariables:\n  - name: for\n    type: string\n    default: 10m\n    description: For eg 5m, 2h; Golang duration format\n  - name: warning\n    type: int\n    default: 80\n  - name: critical\n    type: int\n    default: 90\ntags:\n  - systems\n')),(0,n.kt)("p",null,"Please note that, the mandatory keys, in order to successfully store Alert History of Cortex Alertmanager provider is,"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},"labels:\n  severity: CRITICAL\nannotations:\n  resource: { { $labels.instance } }\n  template: CPU\n  metricName: cpu_usage_user\n  metricValue: { { $labels.cpu_usage_user } }\n")),(0,n.kt)("p",null,"The keys are pretty obvious to match with what was described in bullets points in the introduction above. The above annotations and labels will be parsed by Siren APIs to be stored in the database and would affect the content of notification message."),(0,n.kt)("h3",{id:"alert-history-creation-via-api"},"Alert History Creation via API"),(0,n.kt)(i.Z,{groupId:"api",mdxType:"Tabs"},(0,n.kt)(s.Z,{value:"http",label:"HTTP",mdxType:"TabItem"},(0,n.kt)(l.Z,{className:"language-bash",mdxType:"CodeBlock"},"$ curl --request POST\n  --url ",b,"/",f,'/alerts/cortex/1\n  --header \'content-type: application/json\'\n  --data-raw \'{\n    "alerts": [\n        {\n            "status": "firing",\n            "labels": {\n                "severity": "CRITICAL"\n            },\n            "annotations": {\n                "resource": "apolloVM",\n                "template": "CPU",\n                "metricName": "cpu_usage_user",\n                "metricValue": "90"\n            }\n        }\n    ]\n}\''))),(0,n.kt)("p",null,"The request body of Alertmanager POST call to configured webhook looks something like (after you have followed the labels and annotations in the templates) the above snippet. The contract complies with Cortex Alertmanager ",(0,n.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/alerting/latest/configuration/#webhook_config"},"webhook_config")," body. Siren's alerts API will parse the above payload and also store in the database, which you can fetch via the GET APIs with proper filters of startTime, endTime. See the swagger file for more details."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Alert Notification Payload Template")),(0,n.kt)("p",null,"For each receiver, Siren has a default notification payload template to render Cortex alert notification. See ",(0,n.kt)("a",{parentName:"p",href:"/siren/docs/guides/notification#message-payload-format"},"notification"),"."))}v.isMDXComponent=!0},3618:function(e,t,r){"use strict";r.r(t);t.default={plain:{color:"#F8F8F2",backgroundColor:"#282A36"},styles:[{types:["prolog","constant","builtin"],style:{color:"rgb(189, 147, 249)"}},{types:["inserted","function"],style:{color:"rgb(80, 250, 123)"}},{types:["deleted"],style:{color:"rgb(255, 85, 85)"}},{types:["changed"],style:{color:"rgb(255, 184, 108)"}},{types:["punctuation","symbol"],style:{color:"rgb(248, 248, 242)"}},{types:["string","char","tag","selector"],style:{color:"rgb(255, 121, 198)"}},{types:["keyword","variable"],style:{color:"rgb(189, 147, 249)",fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(98, 114, 164)"}},{types:["attr-name"],style:{color:"rgb(241, 250, 140)"}}]}},7694:function(e,t,r){"use strict";r.r(t);t.default={plain:{color:"#393A34",backgroundColor:"#f6f8fa"},styles:[{types:["comment","prolog","doctype","cdata"],style:{color:"#999988",fontStyle:"italic"}},{types:["namespace"],style:{opacity:.7}},{types:["string","attr-value"],style:{color:"#e3116c"}},{types:["punctuation","operator"],style:{color:"#393A34"}},{types:["entity","url","symbol","number","boolean","variable","constant","property","regex","inserted"],style:{color:"#36acaa"}},{types:["atrule","keyword","attr-name","selector"],style:{color:"#00a4db"}},{types:["function","deleted","tag"],style:{color:"#d73a49"}},{types:["function-variable"],style:{color:"#6f42c1"}},{types:["tag","selector","keyword"],style:{color:"#00009f"}}]}}}]);