"use strict";(self.webpackChunksiren=self.webpackChunksiren||[]).push([[907],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(h,o(o({ref:t},c),{},{components:n})):r.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9021:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=n(3117),a=(n(7294),n(3905));const i={},o="Setup Server",l={unversionedId:"tour/setup_server",id:"tour/setup_server",title:"Setup Server",description:"Siren binary contains both the CLI client and the server itself. Each has it's own configuration in order to run. Server configuration contains information such as database credentials, log severity, etc. while CLI client configuration only has configuration about which server to connect.",source:"@site/docs/tour/setup_server.md",sourceDirName:"tour",slug:"/tour/setup_server",permalink:"/siren/docs/tour/setup_server",draft:!1,editUrl:"https://github.com/odpf/siren/edit/master/docs/docs/tour/setup_server.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Introduction",permalink:"/siren/docs/tour/introduction"},next:{title:"1 Sending On-demand Notification",permalink:"/siren/docs/tour/1sending_notifications_overview"}},s={},p=[{value:"Server",id:"server",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Starting the server",id:"starting-the-server",level:3},{value:"Using environment variables",id:"using-environment-variables",level:3},{value:"CLI Client",id:"cli-client",level:2},{value:"Initialization",id:"initialization-1",level:3}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"setup-server"},"Setup Server"),(0,a.kt)("p",null,"Siren binary contains both the CLI client and the server itself. Each has it's own configuration in order to run. Server configuration contains information such as database credentials, log severity, etc. while CLI client configuration only has configuration about which server to connect."),(0,a.kt)("h2",{id:"server"},"Server"),(0,a.kt)("h3",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("p",null,"Dependencies"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"PostgreSQL"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://cortexmetrics.io/docs/getting-started/"},"CortexMetrics"))),(0,a.kt)("p",null,"You need to prepare and run above dependencies first before running Siren. Siren also has a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/odpf/siren/blob/main/docker-compose.yaml"},(0,a.kt)("inlineCode",{parentName:"a"},"docker-compose.yaml"))," file in its repo that has all required dependencies. If you are interested to use it, you just need to ",(0,a.kt)("inlineCode",{parentName:"p"},"git clone")," the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/odpf/siren"},"repo")," and run ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose up")," in the root project."),(0,a.kt)("h3",{id:"initialization"},"Initialization"),(0,a.kt)("p",null,"This steps assumes all dependencies already up and running. Create a server config ",(0,a.kt)("inlineCode",{parentName:"p"},"config.yaml")," file (",(0,a.kt)("inlineCode",{parentName:"p"},"siren server init"),") in the root folder of siren project or use ",(0,a.kt)("inlineCode",{parentName:"p"},"--config")," flag to customize to a certain config file location or you can also use environment variables to provide the server config. "),(0,a.kt)("p",null,"Setup up a database in postgres and provide the details in the DB field as given in the example below. For the purpose of this tutorial, we'll assume that the username is ",(0,a.kt)("inlineCode",{parentName:"p"},"postgres"),", database name is ",(0,a.kt)("inlineCode",{parentName:"p"},"siren_development"),", host and port are ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"5432"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"db:\n  driver: postgres\n  url: postgres://postgres:@localhost:5432/siren_development?sslmode=disable\n  ...\nservice:\n  host: localhost\n  port: 8080\n  encryption_key: _ENCRYPTIONKEY_OF_32_CHARACTERS_\nlog:\n  level: info\n  gcp_compatible: true\nproviders:\n  cortex:\n    group_wait: 30s\n    webhook_base_api: http://host.docker.internal:8080/v1beta1/alerts/cortex\nreceivers:\n  slack:\n    ...\n")),(0,a.kt)("p",null,"We are using CortexMetrics as a provider. We need to set the ",(0,a.kt)("inlineCode",{parentName:"p"},"webhook_base_api")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"providers.cortex")," config. If you are using the dockerized CortexMetrics with Docker Desktop, you could put the value as ",(0,a.kt)("inlineCode",{parentName:"p"},"http://host.docker.internal:8080/v1beta1/alerts/cortex"),". This will enable CortexMetrics inside container to talk with Siren in our host machine later. If you are running CortexMetrics inside your host, you could put the value as ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/v1beta1/alerts/cortex"),"."),(0,a.kt)("p",null," You also might want to set the ",(0,a.kt)("inlineCode",{parentName:"p"},"provider.cortex.group_wait")," value to ",(0,a.kt)("inlineCode",{parentName:"p"},"1s")," so alert will be sent to the webhook immediately once it was triggered."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you're new to YAML and want to learn more, see Learn ",(0,a.kt)("a",{parentName:"p",href:"https://learnxinyminutes.com/docs/yaml/"},"YAML in Y minutes"),".")),(0,a.kt)("h3",{id:"starting-the-server"},"Starting the server"),(0,a.kt)("p",null,"Database migration is required during the first server initialization. In addition, re-running the migration command might be needed in a new release to apply the new schema changes (if any). It's safer to always re-run the migration script before deploying/starting a new release."),(0,a.kt)("p",null,"To initialize the database schema, Run Migrations with the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ siren server migrate\n")),(0,a.kt)("p",null,"To run the Siren server use command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ siren server start\n")),(0,a.kt)("p",null,"Using ",(0,a.kt)("inlineCode",{parentName:"p"},"--config")," flag"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ siren server migrate --config=<path-to-file>\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ siren server start --config=<path-to-file>\n")),(0,a.kt)("h3",{id:"using-environment-variables"},"Using environment variables"),(0,a.kt)("p",null,"All the configs can be passed as environment variables using underscore ",(0,a.kt)("inlineCode",{parentName:"p"},"_")," as the delimiter between nested keys. See the following examples"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"db:\n  driver: postgres\n  url: postgres://postgres:@localhost:5432/siren_development?sslmode=disable\nservice:\n  host: localhost\n  port: 8080\n  encryption_key: _ENCRYPTIONKEY_OF_32_CHARACTERS_\n")),(0,a.kt)("p",null,"Here is the corresponding environment variable for the above"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Configuration key"),(0,a.kt)("th",{parentName:"tr",align:null},"Environment variable"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"db.driver"),(0,a.kt)("td",{parentName:"tr",align:null},"DB_DRIVER")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"db.url"),(0,a.kt)("td",{parentName:"tr",align:null},"DB_URL")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"service.host"),(0,a.kt)("td",{parentName:"tr",align:null},"SERVICE_HOST")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"service.port"),(0,a.kt)("td",{parentName:"tr",align:null},"SERVICE_PORT")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"service.encryption_key"),(0,a.kt)("td",{parentName:"tr",align:null},"SERVICE_ENCRYPTION_KEY")))),(0,a.kt)("p",null,"Set the env variable using export"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ export SERVICE_PORT=8080\n")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"cli-client"},"CLI Client"),(0,a.kt)("h3",{id:"initialization-1"},"Initialization"),(0,a.kt)("p",null,"Siren CLI supports CLI client to communicate with a Siren server. To initialize the client configuration, run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"$ siren config init\n")),(0,a.kt)("p",null,"A yaml file will be created in the ",(0,a.kt)("inlineCode",{parentName:"p"},"~/.config/odpf/siren.yaml")," directory. Open this file to configure the host for Siren server as in the example below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'host: "localhost:8080"\n')))}u.isMDXComponent=!0}}]);